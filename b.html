<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title id="blog-title">Hello...</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico" />

    <!-- Bootstrap & Fonts -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link href="../css/styles.css" rel="stylesheet" />

    <script src="https://cdn.jsdelivr.net/npm/showdown/dist/showdown.min.js"></script>

    <style>
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        font-family: "EB Garamond", serif;
        font-size: 22px;
        line-height: 1.7;
        letter-spacing: 0.5px;
      }

      main {
        flex: 1 0 auto;
      }

      #content {
        min-height: calc(100vh - 56px - 60px);
        padding: 20px 0;
      }

      /* Blog Hero Section */
      #blog-hero-wrapper {
        position: relative;
        width: 100vw;
        height: 800px;
        overflow: hidden;
      }

      #blog-hero {
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        filter: grayscale(100%) brightness(50%) contrast(120%);
      }

      #blog-hero-text {
        position: absolute;
        top: 35%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white !important;
        font-size: 3rem;
        font-weight: bold;
        text-align: center;
        width: 90%;
        max-width: 800px;
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7);
      }

      #blog-title {
        font-size: 2.8rem;
        font-weight: 700;
        text-align: center;
        margin-bottom: 20px;
      }

      .datentag {
        padding-left: 0px;
      }

      #blog-hero-caption {
        color: #555; /* ‚úÖ Slightly muted color for elegance */
        font-size: 14px;
        font-weight: 500;
        background: transparent; /* ‚úÖ No background needed since it‚Äôs below the image */
        padding: 5px 0;
      }
      #blog-hero-caption-wrapper {
        text-align: center;
        margin-top: 10px; /* ‚úÖ Space between image and caption */
      }

      /* Mobile-friendly adjustments */
      @media (max-width: 768px) {
        body {
          padding: 0px;
          width: 100vw;
          overflow-x: hidden;
        }
        .datentag {
          padding-left: 15px;
          font-size: 1.2rem;
        }

        #blog-hero-text {
          font-size: 2rem;
        }

        #blog-hero-wrapper {
    position: relative;
    width: 100vw; /* ‚úÖ Full viewport width */
    max-width: 100vw; /* ‚úÖ Prevents unnecessary restrictions */
    height: auto; /* ‚úÖ Allow dynamic height */
    min-height: 250px;
    overflow: hidden;
    margin: 0; /* ‚úÖ Ensures no extra margins */
    padding: 0;
}


        #blog-hero {
          width: 100vw; /* ‚úÖ Full viewport width */
          height: 500px; /* ‚úÖ Let it adjust dynamically */
          object-fit: cover;
          align-content: stretch;
        }

        #blog-title {
          font-size: 2rem;
        }

        #blog-content {
          padding: 15px;
        }

        /* Mobile Font Adjustments */
        h1 {
          font-size: 28px !important;
          font-family: "EB Garamond", serif;
          padding-left: 5px;
          padding-right: 5px;
          text-align: left;
        }

        h2 {
          font-size: 24px !important;
          font-family: "EB Garamond", serif;
          padding-left: 10px;
          padding-right: 10px;
        }

        p.fs-5 {
          font-size: 20px !important;
          font-family: "EB Garamond", serif;
          padding-left: 10px;
          padding-right: 10px;
        }

        ul.fs-5 li {
          font-size: 20px !important;
          margin-bottom: 8px;
          font-family: "EB Garamond", serif;
          padding-left: 10px;
          padding-right: 10px;
        }

        .container.px-5.my-5 {
          padding-left: 15px !important;
          padding-right: 15px !important;
        }

        .py-5 {
          padding-top: 2rem !important;
          padding-bottom: 2rem !important;
        }
      }
    </style>
  </head>

  <body class="d-flex flex-column">
    <main class="flex-shrink-0">
      <!-- Navigation -->
      <div id="navbar3"></div>
      <div class="mb-0" style="background-color: black"><br /><br /></div>
      <!-- Hero Section (Blog Cover Image & Title) -->
      <div id="blog-hero-wrapper">
        <figure id="blog-hero" class="mb-lg-0"></figure>
        <div id="blog-hero-text">Loading...</div>
      </div>

      <!-- ‚úÖ Move the caption below the image -->
      <div id="blog-hero-caption-wrapper" class="text-center">
        <figcaption id="blog-hero-caption" class="mt-2">
          <span class="figure-article-caption-owner">Loading...</span>
        </figcaption>
      </div>

      <!-- Blog Content -->
      <section class="py-5">
        <div class="container px-5 my-5">
          <div class="row gx-5">
            <div class="col-lg-3">
              <div class="d-flex align-items-center mt-lg-5 mb-4">
                <img
                  class="img-fluid rounded-circle"
                  src="../assets/images/abhang.jpg"
                  alt="Author"
                  style="width: 50px; height: 50px; object-fit: cover"
                />
                <div class="ms-3">
                  <div class="fw-bold">Abhang Mehendale</div>
                  <div class="text-muted" id="blog-category">Loading...</div>
                </div>
              </div>
            </div>
            <div class="col-lg-9">
              <article>
                <header class="mb-4 datentag">
                  <h1 class="fw-bolder mb-1" id="blog-heading">Loading...</h1>
                  <div class="text-muted fst-italic mb-2" id="blog-date">
                    Loading...
                  </div>
                </header>
                <section id="blog-content" class="mb-5">
                  <p>Loading...</p>
                </section>
              </article>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <div id="footer"></div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="../js/scripts.js"></script>
    <!-- Load Navbar & Footer -->
    <script>
      $("#navbar3").load("../components/navbar3.html");
      $("#footer").load("../components/footer.html");
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>

    <!-- Load Blog Content -->
    <script>
      async function loadBlog() {
        const urlParams = new URLSearchParams(window.location.search);
        const blogFile = urlParams.get("blog");

        if (!blogFile) {
          document.getElementById("blog-content").innerHTML =
            "<p>Blog not found.</p>";
          return;
        }

        const blogPath = `/blogs/${blogFile}.md`;
        console.log("üîç Fetching blog from:", blogPath);

        try {
          const response = await fetch(blogPath, { cache: "no-store" });

          if (!response.ok) {
            throw new Error(`Blog file not found: ${blogPath}`);
          }

          const text = await response.text();
          console.log("üîç Raw Markdown Content:\n", text); // Debugging output

          // ‚úÖ Use `js-yaml` to parse metadata
          let metadata = {};
          let markdownContent = text;

          if (text.startsWith("---")) {
            const endMetaIndex = text.indexOf("\n---", 3);
            if (endMetaIndex !== -1) {
              const yamlText = text.substring(3, endMetaIndex).trim();
              markdownContent = text.substring(endMetaIndex + 4).trim();

              console.log("üõ† Extracted YAML Content:\n", yamlText); // Debugging output

              // ‚úÖ Use js-yaml to parse metadata properly
              try {
                metadata = jsyaml.load(yamlText);
              } catch (yamlError) {
                console.error("‚ùå Error parsing YAML metadata:", yamlError);
              }
            }
          }

          console.log("‚úÖ Parsed Metadata:", metadata); // Debugging output

          // ‚úÖ Ensure metadata actually has values
          if (!metadata || !metadata.title) {
            console.error(
              "‚ùå Metadata parsing failed! Metadata object is empty."
            );
            document.getElementById("blog-content").innerHTML =
              "<p>Error loading blog metadata.</p>";
            return;
          }

          // ‚úÖ Apply Metadata Correctly
          document.getElementById("blog-title").innerText = metadata.title;
          document.getElementById("blog-heading").innerText = metadata.title;
          document.getElementById("blog-date").innerText =
            metadata.date || "Unknown Date";
          document.getElementById("blog-category").innerText =
            metadata.category || "Uncategorized";
          document.getElementById("blog-hero-text").innerText = metadata.title;
          document.getElementById("blog-hero-caption").innerHTML =
            metadata.image_credit || ""; // ‚úÖ Add image credit
          if (metadata.image) {
            document.getElementById(
              "blog-hero"
            ).style.backgroundImage = `url('${metadata.image}')`;
          } else {
            document.getElementById("blog-hero").style.backgroundImage =
              "url('/assets/default-image.jpg')";
          }

          // ‚úÖ Convert Markdown to HTML
          const converter = new showdown.Converter();
          document.getElementById("blog-content").innerHTML =
            converter.makeHtml(markdownContent);
        } catch (error) {
          console.error("‚ùå Error loading blog:", error);
          document.getElementById("blog-content").innerHTML =
            "<p>Error loading blog.</p>";
        }
      }

      // Load the blog when page loads
      document.addEventListener("DOMContentLoaded", loadBlog);
    </script>
  </body>
</html>
