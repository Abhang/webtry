<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IIMM DISHA 2025 - Final Utility</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;700;900&family=Merriweather:wght@300;700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Raleway", sans-serif;
        background-color: #0f172a;
        color: white;
      }

      /* === SLIDE CONTAINER === */
      #slide-container {
        width: 1280px;
        height: 720px;
        position: relative;
        overflow: hidden;
        flex-shrink: 0;
        background: radial-gradient(
          circle at 10% 20%,
          #1e3a8a 0%,
          #0f172a 60%,
          #020617 100%
        );
      }

      /* Background Pattern */
      .bg-pattern {
        position: absolute;
        inset: 0;
        background-image: linear-gradient(
            rgba(255, 255, 255, 0.03) 1px,
            transparent 1px
          ),
          linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        background-size: 40px 40px;
        mask-image: radial-gradient(
          circle at center,
          black 40%,
          transparent 100%
        );
      }

      /* Glass Card */
      .glass-card {
        background: rgba(255, 255, 255, 0.96); 
        backdrop-filter: blur(10px);
        border-radius: 24px 0 0 24px;
        box-shadow: -10px 0 30px rgba(0, 0, 0, 0.3);
      }

      .serif-font {
        font-family: "Merriweather", serif;
      }

      /* Speaker Image Div */
      #slideImageDiv {
        width: 100%;
        height: 100%;
        background-color: #1e293b;
        background-position: center top;
        background-size: cover;
        background-repeat: no-repeat;
      }

      /* Bio List Styling */
      .bio-list li {
        position: relative;
        padding-left: 2rem;
        margin-bottom: 0.6em;
        color: #1e293b;
        font-weight: 500;
        line-height: 1.4;
        transition: font-size 0.2s ease; 
      }
      .bio-list li::before {
        content: "âœ¦";
        color: #d97706;
        position: absolute;
        left: 0;
        top: 0.1em;
        font-size: 1.1em;
      }

      /* Theme List Styling */
      .theme-list li {
        display: inline-block;
        margin-right: 1.5rem;
        font-size: 0.75rem;
        font-weight: 700;
        letter-spacing: 0.05em;
        color: #64748b;
      }
      .theme-list li::before {
        content: "â€¢";
        color: #d97706;
        margin-right: 0.3rem;
      }
      
      /* Slider Customization */
      input[type=range] {
        height: 4px;
        background: #334155;
        border-radius: 2px;
        outline: none;
      }
      input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: #eab308;
        cursor: pointer;
      }
    </style>
  </head>
  <body class="h-screen flex flex-col lg:flex-row overflow-hidden">
    
    <div class="w-full lg:w-1/3 bg-slate-900 h-full border-r border-slate-700 flex flex-col z-20 shadow-2xl text-slate-200 overflow-hidden">
      <div class="p-4 border-b border-slate-700 bg-slate-800">
        <h1 class="text-lg font-bold text-white tracking-wide">
          IIMM DISHA <span class="text-yellow-500">2025</span>
        </h1>
      </div>

      <div class="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin scrollbar-thumb-slate-700">
        
        <div class="p-3 bg-slate-800 rounded border border-slate-700">
          <p class="text-[10px] font-bold text-yellow-500 uppercase mb-2">Logos (Defaults Loaded)</p>
          <div class="grid grid-cols-2 gap-2">
            <input type="file" id="logo1Input" accept="image/*" class="text-xs w-full text-slate-400" />
            <input type="file" id="logo2Input" accept="image/*" class="text-xs w-full text-slate-400" />
          </div>
          <p class="text-[9px] text-slate-500 mt-1">Upload to override defaults.</p>
        </div>

        <div>
          <label class="block text-xs font-bold text-slate-400 mb-1">Speaker Photo</label>
          <input type="file" id="photoInput" accept="image/*" class="block w-full text-xs text-slate-500" />
        </div>

        <hr class="border-slate-700" />

        <div class="space-y-2">
          <input type="text" id="nameInput" placeholder="Full Name" class="w-full p-2 bg-slate-800 border border-slate-600 rounded text-sm focus:border-yellow-500 outline-none" oninput="updateSlide()" />
          <input type="text" id="roleInput" placeholder="Designation" class="w-full p-2 bg-slate-800 border border-slate-600 rounded text-sm focus:border-yellow-500 outline-none" oninput="updateSlide()" />
          <input type="text" id="companyInput" placeholder="Company" class="w-full p-2 bg-slate-800 border border-slate-600 rounded text-sm focus:border-yellow-500 outline-none" oninput="updateSlide()" />
        </div>

        <div class="bg-slate-800 p-2 rounded border border-slate-700">
            <label class="block text-xs font-bold text-slate-400 mb-1">Speaker Bio</label>
            <textarea id="bioInput" rows="5" class="w-full p-2 bg-slate-900 border border-slate-600 rounded text-sm focus:border-yellow-500 outline-none mb-2" placeholder="â€¢ Bullet point 1...&#10;â€¢ Bullet point 2..." oninput="updateSlide()"></textarea>
            
            <div class="flex items-center justify-between px-1">
                <label class="text-xs text-yellow-500 font-bold uppercase tracking-wider">Bio Text Size</label>
                <div class="flex items-center gap-2">
                    <span class="text-xs text-slate-400">A-</span>
                    <input type="range" id="bioSizeInput" min="12" max="24" value="16" class="w-24" oninput="updateSlide()">
                    <span class="text-xs text-slate-400">A+</span>
                </div>
            </div>
        </div>

        <div>
          <label class="block text-xs font-bold text-yellow-500 mb-1">Session Topic (Optional)</label>
          <input type="text" id="topicInput" placeholder="e.g. The Mind and Soul Talk" class="w-full p-2 bg-slate-800 border border-slate-600 rounded text-sm focus:border-yellow-500 outline-none" oninput="updateSlide()" />
        </div>
      </div>

      <div class="p-4 bg-slate-800 border-t border-slate-700 grid grid-cols-2 gap-3">
        <button onclick="downloadImage()" class="bg-slate-700 hover:bg-slate-600 text-white py-3 rounded text-sm font-bold transition flex justify-center items-center gap-2">
          <span>ðŸ“¸</span> Save PNG
        </button>
        <button onclick="generateEditablePPT()" class="bg-yellow-600 hover:bg-yellow-500 text-slate-900 py-3 rounded text-sm font-bold transition flex justify-center items-center gap-2">
          <span>ðŸ“Š</span> Download PPTX
        </button>
      </div>
    </div>

    <div class="w-full lg:w-2/3 bg-slate-950 flex items-center justify-center p-8 overflow-hidden relative" id="preview-container-box">
      <div id="preview-wrapper" style="transform-origin: center; transition: transform 0.2s">
        
        <div id="slide-container">
          <div class="bg-pattern"></div>
          
          <div class="absolute -left-20 top-20 w-96 h-96 rounded-full border border-yellow-500/20 blur-sm"></div>
          <div class="absolute -left-10 top-32 w-72 h-72 rounded-full border border-yellow-500/10 blur-sm"></div>

          <div class="absolute top-0 left-0 w-[35%] h-full flex flex-col justify-center px-12 z-10">
            
            <div class="relative w-64 h-80 mb-8 mx-auto group">
              <div class="absolute -top-3 -left-3 w-full h-full border-2 border-yellow-500 rounded-lg"></div>
              <div class="relative w-full h-full rounded-lg overflow-hidden shadow-2xl border border-slate-600 bg-slate-800">
                <div id="slideImageDiv" style="background-image: url('https://via.placeholder.com/400x500?text=Upload+Photo');"></div>
              </div>
            </div>

            <div class="flex flex-col items-center justify-center text-center w-full">
              <h1 id="slideName" class="serif-font text-white text-4xl font-bold leading-tight mb-3 drop-shadow-lg w-full">
                Speaker Name
              </h1>
              
              <div class="w-16 h-1 bg-gradient-to-r from-yellow-500 to-orange-600 rounded-full my-4"></div>
              
              <h2 id="slideRole" class="text-blue-200 text-sm font-bold uppercase tracking-widest mb-1 w-full">
                Designation
              </h2>
              <h3 id="slideCompany" class="text-slate-300 text-lg font-medium w-full">
                Company Name
              </h3>
            </div>
          </div>

          <div class="absolute top-8 bottom-8 right-0 w-[62%] glass-card z-20 flex flex-col pl-16 pr-12 py-8">
            
            <div class="flex justify-between items-start border-b border-slate-200 pb-4 mb-6 flex-shrink-0">
              <div>
                <h2 class="text-slate-900 font-bold text-3xl tracking-tight mb-2">
                  IIMM DISHA <span class="text-yellow-600">2025</span>
                </h2>
                <ul class="theme-list flex flex-wrap uppercase">
                  <li>Innovation</li>
                  <li>AI-Powered</li>
                  <li>Growth Enablement</li>
                  <li>Manufacturing Excellence</li>
                  <li>Transformative Value</li>
                </ul>
              </div>
              <div class="flex items-center gap-4 h-24" style="margin-right: 50px">
                <img 
                  id="logo1Display" 
                  crossorigin="anonymous" 
                  src="https://res.cloudinary.com/dzjcz0ckk/image/upload/v1765110344/drawing_rotdjf.svg" 
                  class="h-full w-auto object-contain filter drop-shadow-md" 
                />
                <img 
                  id="logo2Display" 
                  crossorigin="anonymous" 
                  src="https://res.cloudinary.com/dzjcz0ckk/image/upload/v1765110344/drawing_50_yrs_ziy9jk.svg" 
                  class="h-full w-auto object-contain filter drop-shadow-md" 
                />
              </div>
            </div>

            <div class="flex-1 flex flex-col min-h-0">
              <ul id="slideBio" class="bio-list overflow-hidden">
                <li>Bio points will appear here.</li>
                <li>Add them in the box on the left.</li>
                <li>Adjust size with the slider.</li>
              </ul>
            </div>

            <div id="topicContainer" class="pt-3 border-t border-slate-300 hidden mt-4 flex-shrink-0">
              <p class="text-xs text-slate-500 font-bold uppercase tracking-wider mb-1">Speaking On</p>
              <p id="slideTopic" class="text-xl font-bold text-slate-900 leading-tight serif-font">Topic Title...</p>
            </div>
          </div>
          
        </div>
      </div>
    </div>

    <script>
      // --- GLOBAL DATA ---
      let imgDataURI = null;
      let logo1URI = null;
      let logo2URI = null;

      // --- 1. SETUP & HANDLERS ---
      function setupUpload(inputId, targetId, varName, isBg = false) {
        document.getElementById(inputId).addEventListener("change", (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (evt) => {
              const res = evt.target.result;
              const el = document.getElementById(targetId);
              
              if (isBg) {
                el.style.backgroundImage = `url('${res}')`;
              } else {
                el.src = res;
              }

              if (varName === "img") imgDataURI = res;
              if (varName === "l1") logo1URI = res;
              if (varName === "l2") logo2URI = res;
            };
            reader.readAsDataURL(file);
          }
        });
      }
      
      setupUpload("photoInput", "slideImageDiv", "img", true);
      setupUpload("logo1Input", "logo1Display", "l1");
      setupUpload("logo2Input", "logo2Display", "l2");

      function setText(tid, sid, def) {
        document.getElementById(tid).textContent =
          document.getElementById(sid).value || def;
      }

      function updateSlide() {
        setText("slideName", "nameInput", "Speaker Name");
        setText("slideRole", "roleInput", "Designation");
        setText("slideCompany", "companyInput", "Company Name");

        // Bio Logic
        const bioText = document.getElementById("bioInput").value;
        const listEl = document.getElementById("slideBio");
        
        if (bioText.trim()) {
          listEl.innerHTML = "";
          bioText.split("\n").forEach((line) => {
            if (line.trim()) {
              const li = document.createElement("li");
              let formatted = line.trim()
                .replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>")
                .replace(/\*(.+?)\*/g, "<em>$1</em>");
              li.innerHTML = formatted;
              listEl.appendChild(li);
            }
          });
        } else {
          listEl.innerHTML = `<li>Bio points will appear here.</li><li>Add them in the box on the left.</li><li>Adjust size with the slider.</li>`;
        }

        const bioSize = document.getElementById("bioSizeInput").value;
        listEl.style.fontSize = bioSize + "px";

        // Topic Logic
        const topic = document.getElementById("topicInput").value;
        const topicCont = document.getElementById("topicContainer");
        if (topic.trim()) {
          topicCont.classList.remove("hidden");
          document.getElementById("slideTopic").textContent = topic;
        } else {
          topicCont.classList.add("hidden");
        }
      }

      // --- 2. PREVIEW SCALING ---
      function resizePreview() {
        const wrapper = document.getElementById("preview-wrapper");
        const parent = document.getElementById("preview-container-box");
        const scale = Math.min(
          (parent.clientWidth - 40) / 1280,
          (parent.clientHeight - 40) / 720
        );
        wrapper.style.transform = `scale(${scale})`;
        wrapper.style.width = "1280px";
        wrapper.style.height = "720px";
      }
      window.addEventListener("resize", resizePreview);
      resizePreview();
      updateSlide();

      // --- 3. HIGH-RES DOWNLOAD ---
      async function downloadImage() {
        const wrapper = document.getElementById("preview-wrapper");
        const slide = document.getElementById("slide-container");
        const originalTransform = wrapper.style.transform;

        wrapper.style.transition = "none";
        wrapper.style.transform = "none";
        
        await new Promise(r => setTimeout(r, 50));

        try {
          const canvas = await html2canvas(slide, {
            scale: 2, 
            useCORS: true, // Critical for Cloudinary Images
            allowTaint: true,
            backgroundColor: null,
            width: 1280,
            height: 720
          });

          const link = document.createElement("a");
          link.download = `IIMM_Speaker_${document.getElementById('nameInput').value.replace(/\s/g,'_')}.png`;
          link.href = canvas.toDataURL("image/png", 1.0);
          link.click();
        } catch (error) {
          console.error(error);
          alert("Error generating image.");
        } finally {
          wrapper.style.transform = originalTransform;
          wrapper.style.transition = "transform 0.2s";
        }
      }

      // --- 4. PPTX EXPORT ---
      function generateEditablePPT() {
        try {
          let pres = new PptxGenJS();
          pres.layout = "LAYOUT_16x9";
          let slide = pres.addSlide();

          slide.background = { color: "0F172A" };
          slide.addShape(pres.ShapeType.rect, { x: 0, y: 0, w: "40%", h: "100%", fill: "0F172A" });

          // Right Card
          slide.addShape(pres.ShapeType.roundRect, {
            x: 3.8, y: 0.5, w: 6.2, h: 6.5,
            fill: { color: "FFFFFF", transparency: 5 },
            rectRadius: 0.2,
            shadow: { type: "outer", color: "000000", blur: 20, offset: 5, opacity: 0.3 },
          });

          // Speaker Image Frame
          slide.addShape(pres.ShapeType.rect, {
            x: 0.8, y: 1.5, w: 2.5, h: 3.2,
            fill: { type: "none" },
            line: { color: "D97706", width: 2 },
          });
          
          if (imgDataURI) {
            slide.addImage({ data: imgDataURI, x: 1.0, y: 1.7, w: 2.5, h: 3.2, sizing:{type:'cover'} });
          } else {
            slide.addShape(pres.ShapeType.rect, { x: 1.0, y: 1.7, w: 2.5, h: 3.2, fill: "1E293B" });
          }

          // Name
          const name = document.getElementById("nameInput").value || "Speaker Name";
          slide.addText(name, {
            x: 0.2, y: 5.2, w: 3.6, h: 0.8,
            fontSize: 28, fontFace: "Georgia", color: "FFFFFF",
            bold: true, align: "center",
          });

          // Divider (Center Aligned)
          slide.addShape(pres.ShapeType.rect, { x: 1.8, y: 6.0, w: 0.5, h: 0.05, fill: "FBBF24" });

          slide.addText((document.getElementById("roleInput").value || "Designation").toUpperCase(), {
            x: 0.2, y: 6.2, w: 3.6, h: 0.4,
            fontSize: 11, fontFace: "Arial", color: "BFDBFE",
            bold: true, align: "center",
          });
          slide.addText(document.getElementById("companyInput").value || "Company Name", {
            x: 0.2, y: 6.5, w: 3.6, h: 0.5,
            fontSize: 14, fontFace: "Arial", color: "CBD5E1",
            bold: true, align: "center",
          });

          // Right Content
          slide.addText(
            [{ text: "IIMM DISHA ", options: { color: "0F172A", bold: true } }, { text: "2025", options: { color: "D97706", bold: true } }],
            { x: 4.2, y: 0.8, w: 3.0, h: 0.5, fontSize: 24, fontFace: "Arial" }
          );

          const themes = ["Innovation", "AI-Powered", "Growth", "Excellence", "Value"];
          let themeObjs = [];
          themes.forEach((t, i) => {
             themeObjs.push({ text: "â€¢ " + t.toUpperCase(), options: { color: "64748B", bold: true } });
             if(i < themes.length -1) themeObjs.push({ text: "  " });
          });
          slide.addText(themeObjs, { x: 4.2, y: 1.2, w: 5.5, h: 0.3, fontSize: 9, fontFace: "Arial" });

          // LOGIC FOR LOGOS: Use uploaded URI OR fallback to URL
          const logo1Url = "https://res.cloudinary.com/dzjcz0ckk/image/upload/v1765110344/drawing_rotdjf.svg";
          const logo2Url = "https://res.cloudinary.com/dzjcz0ckk/image/upload/v1765110344/drawing_50_yrs_ziy9jk.svg";

          if (logo1URI) {
             slide.addImage({ data: logo1URI, x: 5.8, y: 0.7, w: 2.0, h: 1.4, sizing: { type: "contain", w: 2.0, h: 1.4 } });
          } else {
             // Fallback to URL for PPTX (works if internet available)
             slide.addImage({ path: logo1Url, x: 5.8, y: 0.7, w: 2.0, h: 1.4, sizing: { type: "contain", w: 2.0, h: 1.4 } });
          }

          if (logo2URI) {
             slide.addImage({ data: logo2URI, x: 8.0, y: 0.7, w: 2.0, h: 1.4, sizing: { type: "contain", w: 2.0, h: 1.4 } });
          } else {
             slide.addImage({ path: logo2Url, x: 8.0, y: 0.7, w: 2.0, h: 1.4, sizing: { type: "contain", w: 2.0, h: 1.4 } });
          }

          slide.addShape(pres.ShapeType.line, { x: 4.2, y: 2.3, w: 5.4, h: 0, line: "E2E8F0", lineSize: 1 });

          // Bio
          const bioText = document.getElementById("bioInput").value;
          const userFontSize = parseInt(document.getElementById("bioSizeInput").value) || 14;
          const pptFontSize = Math.max(10, userFontSize - 2); 

          if (bioText) {
            let bullets = bioText.split("\n").filter((l) => l.trim()).map((l) => ({
              text: l.trim(),
              options: { breakLine: true, bullet: { type: "number", color: "D97706" } },
            }));
            slide.addText(bullets, {
              x: 4.2, y: 2.5, w: 5.4, h: 3.8,
              fontSize: pptFontSize, fontFace: "Arial", color: "1E293B",
              paraSpaceAfter: 10, valign: "top",
            });
          }

          const topic = document.getElementById("topicInput").value;
          if (topic.trim()) {
            slide.addShape(pres.ShapeType.line, { x: 4.2, y: 6.3, w: 5.4, h: 0, line: "E2E8F0", lineSize: 1 });
            slide.addText("SPEAKING ON", { x: 4.2, y: 6.4, w: 2.0, h: 0.2, fontSize: 8, color: "64748B", bold: true });
            slide.addText(topic, { x: 4.2, y: 6.6, w: 5.4, h: 0.4, fontSize: 18, fontFace: "Georgia", color: "0F172A", bold: true });
          }

          pres.writeFile({ fileName: `IIMM-Disha-Speaker.pptx` });
        } catch (err) {
          alert("Error: " + err.message);
        }
      }
    </script>
  </body>
</html>